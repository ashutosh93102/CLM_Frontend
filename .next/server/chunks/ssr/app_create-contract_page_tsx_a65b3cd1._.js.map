{"version":3,"sources":["../../../../app/create-contract/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { Suspense, useEffect, useMemo, useRef, useState } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport type { Editor } from '@tiptap/react';\nimport { useAuth } from '../lib/auth-context';\nimport {\n  ApiClient,\n  Clause,\n  FileTemplateItem,\n  TemplateFileSchemaResponse,\n  TemplateSchemaField,\n  TemplateSchemaSection,\n} from '../lib/api-client';\nimport DashboardLayout from '../components/DashboardLayout';\nimport RichTextEditor from '../components/RichTextEditor';\nimport { ChevronLeft, FileText, Search, Sparkles } from 'lucide-react';\nimport { sanitizeEditorHtml } from '../lib/sanitize-html';\n\n// Types\ntype Template = FileTemplateItem;\n\ntype Mode = 'templates' | 'ai';\ntype AiStep = 'select' | 'edit';\n\ntype CustomClause = { title?: string; content: string };\ntype Constraint = { name: string; value: string };\ntype ConstraintTemplate = { key: string; label: string; category?: string; default?: string };\n\ntype TemplateDraft = {\n  template: string;\n  fieldValues: Record<string, string>;\n  selectedClauseIds: string[];\n  customClauses: CustomClause[];\n  constraints: Constraint[];\n  updatedAt: number;\n};\n\ntype GenerationContext = TemplateDraft & {\n  contractId: string;\n  createdAt: number;\n};\n\nconst STANDARD_TEMPLATES_ORDER = [\n  'Mutual_NDA.txt',\n  'MSA_Master_Services.txt',\n  'SOW_Statement_of_Work.txt',\n  'Contractor_Agreement.txt',\n];\n\nconst TEMPLATE_CARD_META: Record<\n  string,\n  { title: string; subtitle: string; pill: string; eta: string; iconBg: string; icon: React.ReactNode }\n> = {\n  'Mutual_NDA.txt': {\n    title: 'Mutual NDA',\n    subtitle: 'Protect confidential information between two parties.',\n    pill: 'Standard',\n    eta: '~5 mins',\n    iconBg: 'bg-blue-50 text-blue-600',\n    icon: <FileText className=\"w-5 h-5\" />,\n  },\n  'MSA_Master_Services.txt': {\n    title: 'MSA (Master Services)',\n    subtitle: 'Framework agreement for ongoing service relationships.',\n    pill: 'Complex',\n    eta: '~15 mins',\n    iconBg: 'bg-orange-50 text-orange-600',\n    icon: <FileText className=\"w-5 h-5\" />,\n  },\n  'SOW_Statement_of_Work.txt': {\n    title: 'SOW (Statement of Work)',\n    subtitle: 'Define specific project deliverables and timelines.',\n    pill: 'Project',\n    eta: '~10 mins',\n    iconBg: 'bg-emerald-50 text-emerald-600',\n    icon: <FileText className=\"w-5 h-5\" />,\n  },\n  'Contractor_Agreement.txt': {\n    title: 'Contractor Agreement',\n    subtitle: 'Terms for independent contractors and freelancers.',\n    pill: 'HR',\n    eta: '~8 mins',\n    iconBg: 'bg-violet-50 text-violet-600',\n    icon: <FileText className=\"w-5 h-5\" />,\n  },\n};\n\nconst CreateContractInner = () => {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { user } = useAuth();\n  const [mode, setMode] = useState<Mode>('templates');\n  const [templates, setTemplates] = useState<Template[]>([]);\n  const [templateQuery, setTemplateQuery] = useState('');\n  const [selectedTemplate, setSelectedTemplate] = useState<string>('');\n  const [templatesLoading, setTemplatesLoading] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [fieldValues, setFieldValues] = useState<Record<string, string>>({});\n  const [schemaLoading, setSchemaLoading] = useState(false);\n  const [schema, setSchema] = useState<TemplateFileSchemaResponse | null>(null);\n\n  const [clausesLoading, setClausesLoading] = useState(false);\n  const [clauses, setClauses] = useState<Clause[]>([]);\n  const [clauseQuery, setClauseQuery] = useState('');\n  const [selectedClauseIds, setSelectedClauseIds] = useState<string[]>([]);\n\n  const [customClauses, setCustomClauses] = useState<CustomClause[]>([]);\n  const [constraints, setConstraints] = useState<Constraint[]>([]);\n\n  const [constraintLibrary, setConstraintLibrary] = useState<ConstraintTemplate[]>([]);\n  const [constraintLibraryLoading, setConstraintLibraryLoading] = useState(false);\n  const [constraintLibraryQuery, setConstraintLibraryQuery] = useState('');\n\n  const [previewText, setPreviewText] = useState<string>('');\n  const [previewLoading, setPreviewLoading] = useState(false);\n\n  const [templateDraftUpdatedAt, setTemplateDraftUpdatedAt] = useState<number | null>(null);\n  const [templateDraftRestored, setTemplateDraftRestored] = useState(false);\n\n  const [aiStep, setAiStep] = useState<AiStep>('select');\n  const [aiTitle, setAiTitle] = useState('');\n  const [aiPrompt, setAiPrompt] = useState('');\n  const [aiBaseText, setAiBaseText] = useState('');\n  const [aiBaseHtml, setAiBaseHtml] = useState('');\n  const [aiSuggestionText, setAiSuggestionText] = useState('');\n  const [aiTemplateQuery, setAiTemplateQuery] = useState('');\n  const [aiLoadingTemplate, setAiLoadingTemplate] = useState(false);\n  const [aiGenerating, setAiGenerating] = useState(false);\n  const [aiError, setAiError] = useState<string | null>(null);\n  const [aiDraftUpdatedAt, setAiDraftUpdatedAt] = useState<number | null>(null);\n  const aiAbortRef = useRef<AbortController | null>(null);\n  const aiEditorApiRef = useRef<Editor | null>(null);\n  const aiAutoStartTemplateRef = useRef<string>('');\n\n  type AiDraft = {\n    template: string;\n    title: string;\n    html: string;\n    text: string;\n    updatedAt: number;\n  };\n\n  const userDraftKey = useMemo(() => {\n    const u: any = user as any;\n    return String(u?.user_id || u?.id || u?.email || 'anon');\n  }, [user]);\n\n  const getAiDraftStorageKey = (templateFilename: string) => `clm:aiBuilderDraft:v1:${userDraftKey}:${templateFilename}`;\n\n  const getTemplateDraftStorageKey = (templateFilename: string) =>\n    `clm:templateGeneratorDraft:v1:${userDraftKey}:${templateFilename}`;\n\n  const readTemplateDraft = (templateFilename: string): TemplateDraft | null => {\n    try {\n      const raw = localStorage.getItem(getTemplateDraftStorageKey(templateFilename));\n      if (!raw) return null;\n      const obj = JSON.parse(raw);\n      if (!obj || typeof obj !== 'object') return null;\n      return {\n        template: String((obj as any).template || templateFilename),\n        fieldValues: ((obj as any).fieldValues || {}) as Record<string, string>,\n        selectedClauseIds: (Array.isArray((obj as any).selectedClauseIds) ? (obj as any).selectedClauseIds : []) as string[],\n        customClauses: (Array.isArray((obj as any).customClauses) ? (obj as any).customClauses : []) as CustomClause[],\n        constraints: (Array.isArray((obj as any).constraints) ? (obj as any).constraints : []) as Constraint[],\n        updatedAt: Number((obj as any).updatedAt || 0),\n      };\n    } catch {\n      return null;\n    }\n  };\n\n  const writeTemplateDraft = (templateFilename: string, draft: TemplateDraft) => {\n    try {\n      localStorage.setItem(getTemplateDraftStorageKey(templateFilename), JSON.stringify(draft));\n    } catch {\n      // Ignore storage quota/availability issues.\n    }\n  };\n\n  const clearTemplateDraft = (templateFilename: string) => {\n    try {\n      localStorage.removeItem(getTemplateDraftStorageKey(templateFilename));\n    } catch {\n      // Ignore.\n    }\n  };\n\n  const getGenerationContextKey = (contractId: string) => `clm:contractGenerationContext:v1:${contractId}`;\n\n  const writeGenerationContext = (ctx: GenerationContext) => {\n    try {\n      localStorage.setItem(getGenerationContextKey(ctx.contractId), JSON.stringify(ctx));\n    } catch {\n      // Ignore.\n    }\n  };\n\n  const readAiDraft = (templateFilename: string): AiDraft | null => {\n    try {\n      const raw = localStorage.getItem(getAiDraftStorageKey(templateFilename));\n      if (!raw) return null;\n      const obj = JSON.parse(raw);\n      if (!obj || typeof obj !== 'object') return null;\n      return {\n        template: String((obj as any).template || templateFilename),\n        title: String((obj as any).title || ''),\n        html: String((obj as any).html || ''),\n        text: String((obj as any).text || ''),\n        updatedAt: Number((obj as any).updatedAt || 0),\n      };\n    } catch {\n      return null;\n    }\n  };\n\n  const writeAiDraft = (templateFilename: string, draft: AiDraft) => {\n    try {\n      localStorage.setItem(getAiDraftStorageKey(templateFilename), JSON.stringify(draft));\n    } catch {\n      // Ignore storage quota/availability issues.\n    }\n  };\n\n  const clearAiDraft = (templateFilename: string) => {\n    try {\n      localStorage.removeItem(getAiDraftStorageKey(templateFilename));\n    } catch {\n      // Ignore.\n    }\n  };\n\n  const escapeHtml = (s: string) =>\n    (s || '')\n      .replaceAll('&', '&amp;')\n      .replaceAll('<', '&lt;')\n      .replaceAll('>', '&gt;')\n      .replaceAll('\"', '&quot;')\n      .replaceAll(\"'\", '&#039;');\n\n  const textToHtml = (text: string) => {\n    const safe = escapeHtml(text || '');\n    return `<p>${safe.replace(/\\n/g, '<br/>')}</p>`;\n  };\n\n  useEffect(() => {\n    fetchTemplates();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    const filename = searchParams.get('template');\n    if (filename) setSelectedTemplate(filename);\n  }, [searchParams]);\n\n  useEffect(() => {\n    const m = (searchParams.get('mode') || searchParams.get('builder') || '').toLowerCase();\n    if (m === 'ai') setMode('ai');\n  }, [searchParams]);\n\n  useEffect(() => {\n    if (!selectedTemplate) {\n      setSchema(null);\n      setFieldValues({});\n      setSelectedClauseIds([]);\n      setCustomClauses([]);\n      setConstraints([]);\n      setPreviewText('');\n\n      setTemplateDraftUpdatedAt(null);\n      setTemplateDraftRestored(false);\n\n      setAiStep('select');\n      setAiTitle('');\n      setAiPrompt('');\n      setAiBaseText('');\n      setAiBaseHtml('');\n      setAiSuggestionText('');\n      setAiError(null);\n      setAiDraftUpdatedAt(null);\n      return;\n    }\n\n    const loadSchemaAndClauses = async () => {\n      try {\n        setSchemaLoading(true);\n        const client = new ApiClient();\n        const schemaRes = await client.getTemplateFileSchema(selectedTemplate);\n        if (!schemaRes.success) {\n          setSchema(null);\n          return;\n        }\n\n        const s = schemaRes.data as any as TemplateFileSchemaResponse;\n        setSchema(s);\n\n        // Ensure fieldValues has keys for required schema fields.\n        const requiredKeys: string[] = [];\n        for (const section of s.sections || []) {\n          for (const field of section.fields || []) {\n            if (field?.key) requiredKeys.push(field.key);\n          }\n        }\n        setFieldValues((prev) => {\n          const next: Record<string, string> = { ...prev };\n          for (const k of requiredKeys) {\n            if (next[k] === undefined) next[k] = '';\n          }\n          return next;\n        });\n\n        setClausesLoading(true);\n        const clausesRes = await client.getClauses({ contract_type: s.template_type });\n        if (clausesRes.success) {\n          const data: any = clausesRes.data as any;\n          const list = Array.isArray(data) ? data : Array.isArray(data?.results) ? data.results : [];\n          setClauses(list);\n        } else {\n          setClauses([]);\n        }\n\n        setConstraintLibraryLoading(true);\n        const consRes = await client.getConstraintsLibrary({});\n        if (consRes.success) {\n          const data: any = consRes.data as any;\n          const list = Array.isArray(data?.results) ? data.results : Array.isArray(data) ? data : [];\n          setConstraintLibrary(list);\n        } else {\n          setConstraintLibrary([]);\n        }\n      } finally {\n        setSchemaLoading(false);\n        setClausesLoading(false);\n        setConstraintLibraryLoading(false);\n      }\n    };\n\n    loadSchemaAndClauses();\n  }, [selectedTemplate]);\n\n  // Restore template-mode draft when selecting a template (only if current state is empty).\n  useEffect(() => {\n    if (mode !== 'templates') return;\n    if (!user) return;\n    if (!selectedTemplate) return;\n    const empty =\n      Object.keys(fieldValues || {}).length === 0 &&\n      (selectedClauseIds || []).length === 0 &&\n      (customClauses || []).length === 0 &&\n      (constraints || []).length === 0;\n    if (!empty) return;\n\n    const draft = readTemplateDraft(selectedTemplate);\n    if (!draft) {\n      setTemplateDraftUpdatedAt(null);\n      setTemplateDraftRestored(false);\n      return;\n    }\n\n    setFieldValues(draft.fieldValues || {});\n    setSelectedClauseIds(draft.selectedClauseIds || []);\n    setCustomClauses(draft.customClauses || []);\n    setConstraints(draft.constraints || []);\n    setTemplateDraftUpdatedAt(draft.updatedAt || null);\n    setTemplateDraftRestored(true);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mode, user, selectedTemplate]);\n\n  // Auto-save template-mode draft locally.\n  useEffect(() => {\n    if (mode !== 'templates') return;\n    if (!user) return;\n    if (!selectedTemplate) return;\n\n    const t = window.setTimeout(() => {\n      const draft: TemplateDraft = {\n        template: selectedTemplate,\n        fieldValues: fieldValues || {},\n        selectedClauseIds: selectedClauseIds || [],\n        customClauses: customClauses || [],\n        constraints: constraints || [],\n        updatedAt: Date.now(),\n      };\n      writeTemplateDraft(selectedTemplate, draft);\n      setTemplateDraftUpdatedAt(draft.updatedAt);\n    }, 350);\n\n    return () => window.clearTimeout(t);\n  }, [mode, user, selectedTemplate, fieldValues, selectedClauseIds, customClauses, constraints]);\n\n  useEffect(() => {\n    if (mode !== 'ai') return;\n    if (!selectedTemplate) {\n      setAiDraftUpdatedAt(null);\n      return;\n    }\n    const d = readAiDraft(selectedTemplate);\n    setAiDraftUpdatedAt(d?.updatedAt ? d.updatedAt : null);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mode, selectedTemplate, userDraftKey]);\n\n  // Auto-resume saved AI Builder drafts (and optionally auto-start from query params).\n  useEffect(() => {\n    if (mode !== 'ai') return;\n    if (!selectedTemplate) return;\n\n    const draft = readAiDraft(selectedTemplate);\n    if (draft && (draft.html || draft.text)) {\n      setAiError(null);\n      setAiTitle(draft.title || String(selectedTemplateObj?.name || selectedTemplate));\n      setAiBaseText(draft.text || '');\n      setAiBaseHtml(draft.html || textToHtml(draft.text || ''));\n      setAiSuggestionText('');\n      setAiStep('edit');\n      setAiDraftUpdatedAt(draft.updatedAt || Date.now());\n      return;\n    }\n\n    const shouldAutoStart =\n      (searchParams.get('mode') || '').toLowerCase() === 'ai' || (searchParams.get('autostart') || '') === '1';\n    if (!shouldAutoStart) return;\n    if (aiStep !== 'select') return;\n    if (aiAutoStartTemplateRef.current === selectedTemplate) return;\n    aiAutoStartTemplateRef.current = selectedTemplate;\n    // Fire and forget.\n    startAiBuilder();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mode, selectedTemplate, aiStep, searchParams, userDraftKey]);\n\n  // Auto-save AI Builder editor progress locally (so refresh/redirect resumes).\n  useEffect(() => {\n    if (mode !== 'ai') return;\n    if (aiStep !== 'edit') return;\n    if (!selectedTemplate) return;\n    if (!aiBaseHtml && !aiBaseText) return;\n\n    const t = window.setTimeout(() => {\n      const draft: AiDraft = {\n        template: selectedTemplate,\n        title: String(aiTitle || selectedTemplateObj?.name || selectedTemplate),\n        html: aiBaseHtml,\n        text: aiBaseText,\n        updatedAt: Date.now(),\n      };\n      writeAiDraft(selectedTemplate, draft);\n      setAiDraftUpdatedAt(draft.updatedAt);\n    }, 650);\n\n    return () => window.clearTimeout(t);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mode, aiStep, selectedTemplate, aiTitle, aiBaseHtml, aiBaseText]);\n\n  const startAiBuilder = async () => {\n    if (!selectedTemplate) return;\n    try {\n      const existing = readAiDraft(selectedTemplate);\n      if (existing && (existing.html || existing.text)) {\n        setAiError(null);\n        setAiTitle(existing.title || String(selectedTemplateObj?.name || selectedTemplate));\n        setAiBaseText(existing.text || '');\n        setAiBaseHtml(existing.html || textToHtml(existing.text || ''));\n        setAiSuggestionText('');\n        setAiStep('edit');\n        setAiDraftUpdatedAt(existing.updatedAt || Date.now());\n        return;\n      }\n\n      setAiError(null);\n      setAiLoadingTemplate(true);\n      const client = new ApiClient();\n      const res = await client.getTemplateFileContent(selectedTemplate);\n      if (!res.success) {\n        setAiError(res.error || 'Failed to load template');\n        return;\n      }\n      const content = String((res.data as any)?.content || '');\n      const name = String((res.data as any)?.name || '') || String(selectedTemplate || 'Template');\n      setAiTitle(name);\n      setAiBaseText(content);\n      setAiBaseHtml(textToHtml(content));\n      setAiSuggestionText('');\n      setAiStep('edit');\n\n      const draft: AiDraft = {\n        template: selectedTemplate,\n        title: name,\n        html: textToHtml(content),\n        text: content,\n        updatedAt: Date.now(),\n      };\n      writeAiDraft(selectedTemplate, draft);\n      setAiDraftUpdatedAt(draft.updatedAt);\n    } catch (e) {\n      setAiError(e instanceof Error ? e.message : 'Failed to load template');\n    } finally {\n      setAiLoadingTemplate(false);\n    }\n  };\n\n  const applyAiPrompt = async () => {\n    if (aiGenerating) return;\n    const prompt = aiPrompt.trim();\n    if (!prompt) {\n      setAiError('Please enter a prompt');\n      return;\n    }\n    const current = aiEditorApiRef.current?.getText() ?? aiBaseText;\n    if (!current.trim()) {\n      setAiError('Template content is empty');\n      return;\n    }\n\n    aiAbortRef.current?.abort();\n    const aborter = new AbortController();\n    aiAbortRef.current = aborter;\n\n    try {\n      setAiError(null);\n      setAiGenerating(true);\n      let nextText = '';\n      setAiSuggestionText('');\n\n      const client = new ApiClient();\n      await client.streamTemplateAiGenerate(\n        {\n          prompt,\n          current_text: current,\n          contract_type: schema?.template_type || selectedTemplateObj?.contract_type,\n        },\n        {\n          signal: aborter.signal,\n          onDelta: (delta) => {\n            nextText += delta;\n            setAiSuggestionText(nextText);\n          },\n          onDone: () => {\n            setAiSuggestionText(nextText);\n          },\n          onError: (err) => {\n            setAiError(err || 'AI generation failed');\n          },\n        }\n      );\n    } catch (e) {\n      if ((e as any)?.name === 'AbortError') return;\n      setAiError(e instanceof Error ? e.message : 'AI generation failed');\n    } finally {\n      setAiGenerating(false);\n    }\n  };\n\n  const stopAi = () => {\n    aiAbortRef.current?.abort();\n    setAiGenerating(false);\n  };\n\n  const acceptAiSuggestion = () => {\n    const next = (aiSuggestionText || '').trim();\n    if (!next) return;\n    setAiBaseText(next);\n    setAiBaseHtml(textToHtml(next));\n    setAiSuggestionText('');\n  };\n\n  const rejectAiSuggestion = () => {\n    setAiSuggestionText('');\n  };\n\n  const createDraftFromAi = async () => {\n    try {\n      setAiError(null);\n\n      if (!user) {\n        setAiError('Please sign in to create a draft.');\n        return;\n      }\n\n      setLoading(true);\n      const client = new ApiClient();\n      const renderedText = aiEditorApiRef.current?.getText() ?? aiBaseText;\n      const renderedHtmlRaw = aiEditorApiRef.current?.getHTML() ?? aiBaseHtml;\n      const renderedHtml = sanitizeEditorHtml(renderedHtmlRaw);\n      const title = (aiTitle || selectedTemplateObj?.name || 'Contract').trim();\n      const res = await client.createContractFromContent({\n        title,\n        contract_type: schema?.template_type || selectedTemplateObj?.contract_type,\n        rendered_text: renderedText,\n        rendered_html: renderedHtml,\n        metadata: selectedTemplate\n          ? {\n              source: 'ai_builder',\n              template_filename: selectedTemplate,\n              template: selectedTemplate,\n              form_inputs: fieldValues || {},\n              selected_clause_ids: selectedClauseIds || [],\n              selected_clauses: selectedClauseIds || [],\n              custom_clauses: customClauses || [],\n              constraints: constraints || [],\n              editor_client_updated_at_ms: Date.now(),\n            }\n          : {\n              source: 'ai_builder',\n              editor_client_updated_at_ms: Date.now(),\n            },\n      });\n      if (!res.success) {\n        setAiError(res.error || 'Failed to create draft');\n        return;\n      }\n      const id = String((res.data as any)?.id || '');\n      if (!id) {\n        setAiError('Draft created but no contract id returned');\n        return;\n      }\n\n      if (selectedTemplate) {\n        // Persist generation context so the editor + signing flow can access template inputs/clauses.\n        writeGenerationContext({\n          contractId: String(id),\n          template: selectedTemplate,\n          fieldValues: fieldValues || {},\n          selectedClauseIds: selectedClauseIds || [],\n          customClauses: customClauses || [],\n          constraints: constraints || [],\n          updatedAt: aiDraftUpdatedAt || Date.now(),\n          createdAt: Date.now(),\n        });\n      }\n\n      if (selectedTemplate) {\n        clearAiDraft(selectedTemplate);\n        setAiDraftUpdatedAt(null);\n      }\n      router.push(`/contracts/editor?id=${encodeURIComponent(id)}`);\n    } catch (e) {\n      setAiError(e instanceof Error ? e.message : 'Failed to create draft');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredClauses = useMemo(() => {\n    const list = Array.isArray(clauses) ? clauses : [];\n    const q = clauseQuery.trim().toLowerCase();\n    if (!q) return list;\n    return list.filter((c) => {\n      const hay = `${c.clause_id} ${c.name} ${c.content}`.toLowerCase();\n      return hay.includes(q);\n    });\n  }, [clauses, clauseQuery]);\n\n  const fetchTemplates = async () => {\n    try {\n      setTemplatesLoading(true);\n      const client = new ApiClient();\n      const templatesResponse = await client.listTemplateFiles();\n\n      if (!templatesResponse.success) {\n        setError(templatesResponse.error || 'Failed to load templates');\n        setTemplates([]);\n      } else {\n        const templateList = (templatesResponse.data as any)?.results || [];\n        setTemplates(templateList);\n\n        const templateFromQuery = searchParams.get('template');\n        if (!templateFromQuery && templateList.length > 0) {\n          const firstStandard = templateList.find((t: any) => STANDARD_TEMPLATES_ORDER.includes(t.filename))\n          setSelectedTemplate((firstStandard || templateList[0]).filename);\n        }\n      }\n    } catch (err) {\n      console.error('Failed to fetch data:', err);\n      setError('Failed to load templates');\n    } finally {\n      setTemplatesLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (!selectedTemplate || mode !== 'templates') return;\n    if (!user) return;\n\n    const timer = window.setTimeout(async () => {\n      try {\n        setPreviewLoading(true);\n        const client = new ApiClient();\n        const res = await client.previewContractFromFile({\n          filename: selectedTemplate,\n          structuredInputs: fieldValues,\n          selectedClauses: selectedClauseIds,\n          customClauses,\n          constraints,\n        });\n        if (res.success) {\n          setPreviewText(((res.data as any)?.rendered_text as string) || '');\n        }\n      } finally {\n        setPreviewLoading(false);\n      }\n    }, 350);\n\n    return () => window.clearTimeout(timer);\n  }, [selectedTemplate, fieldValues, selectedClauseIds, customClauses, constraints, mode, user]);\n\n  const setField = (key: string, value: string) => {\n    setFieldValues((p) => ({ ...p, [key]: value }));\n  };\n\n  const toggleClause = (clauseId: string) => {\n    setSelectedClauseIds((prev) =>\n      prev.includes(clauseId) ? prev.filter((c) => c !== clauseId) : [...prev, clauseId]\n    );\n  };\n\n  const addCustomClause = () => setCustomClauses((p) => [...p, { title: '', content: '' }]);\n  const addConstraint = () => setConstraints((p) => [...p, { name: '', value: '' }]);\n\n  const addConstraintFromLibrary = (t: ConstraintTemplate) => {\n    const name = (t?.label || t?.key || '').trim();\n    if (!name) return;\n    setConstraints((prev) => {\n      const exists = prev.some((c) => (c.name || '').trim().toLowerCase() === name.toLowerCase());\n      if (exists) return prev;\n      return [...prev, { name, value: String(t?.default || '') }];\n    });\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedTemplate) {\n      setError('Please select a template');\n      return;\n    }\n\n    const templateMetaTitle =\n      (selectedTemplate && (TEMPLATE_CARD_META[selectedTemplate]?.title || selectedTemplateObj?.name)) || 'Contract';\n    const partyHint =\n      fieldValues.party_a_name ||\n      fieldValues.party_b_name ||\n      fieldValues.company_name ||\n      fieldValues.client_name ||\n      fieldValues.disclosing_party_name ||\n      fieldValues.receiving_party_name ||\n      '';\n    const derivedTitle = partyHint ? `${templateMetaTitle} — ${partyHint}` : templateMetaTitle;\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const client = new ApiClient();\n      const response = await client.generateContractFromFile({\n        filename: selectedTemplate,\n        title: derivedTitle,\n        selectedClauses: selectedClauseIds,\n        customClauses,\n        constraints,\n        structuredInputs: fieldValues,\n      });\n\n      if (!response.success) {\n        setError(response.error || 'Failed to create contract');\n        return;\n      }\n\n      const contractId = (response.data as any)?.contract?.id;\n      if (contractId) {\n        // Persist generation context so the editor can show template/clauses/inputs.\n        writeGenerationContext({\n          contractId: String(contractId),\n          template: selectedTemplate,\n          fieldValues: fieldValues || {},\n          selectedClauseIds: selectedClauseIds || [],\n          customClauses: customClauses || [],\n          constraints: constraints || [],\n          updatedAt: templateDraftUpdatedAt || Date.now(),\n          createdAt: Date.now(),\n        });\n\n        // Clear local draft after successful generation.\n        clearTemplateDraft(selectedTemplate);\n        setTemplateDraftRestored(false);\n        setTemplateDraftUpdatedAt(null);\n        router.push(`/contracts/editor?id=${encodeURIComponent(String(contractId))}`);\n      } else {\n        router.push('/contracts');\n      }\n    } catch (err) {\n      console.error('Failed to create contract:', err);\n      setError(err instanceof Error ? err.message : 'Failed to create contract');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const selectedTemplateObj = templates.find((t) => t.filename === selectedTemplate) || null;\n\n  const allTemplatesOrdered = useMemo(() => {\n    const standardSet = new Set(STANDARD_TEMPLATES_ORDER);\n    const pinned: Template[] = [];\n    const byFilename = new Map<string, Template>();\n    for (const t of templates) byFilename.set(t.filename, t);\n    for (const f of STANDARD_TEMPLATES_ORDER) {\n      const t = byFilename.get(f);\n      if (t) pinned.push(t);\n    }\n    const rest = templates.filter((t) => !standardSet.has(t.filename));\n    return [...pinned, ...rest];\n  }, [templates]);\n\n  const filteredTemplates = useMemo(() => {\n    const q = templateQuery.trim().toLowerCase();\n    if (!q) return allTemplatesOrdered;\n    return allTemplatesOrdered.filter((t) => {\n      const hay = `${t.filename || ''} ${t.name || ''} ${t.description || ''} ${t.contract_type || ''}`.toLowerCase();\n      return hay.includes(q);\n    });\n  }, [allTemplatesOrdered, templateQuery]);\n\n  const aiFilteredTemplates = useMemo(() => {\n    const q = aiTemplateQuery.trim().toLowerCase();\n    if (!q) return allTemplatesOrdered;\n    return allTemplatesOrdered.filter((t) => {\n      const hay = `${t.filename || ''} ${t.name || ''} ${t.description || ''} ${t.contract_type || ''}`.toLowerCase();\n      return hay.includes(q);\n    });\n  }, [allTemplatesOrdered, aiTemplateQuery]);\n\n  const sections: TemplateSchemaSection[] = schema?.sections || [];\n\n  const isCreateDisabled = !user || !selectedTemplateObj || loading || mode !== 'templates';\n\n  const pageTitle = 'Contract Generator';\n  const pageSubtitle = 'Select a template and autofill details to generate contracts instantly.';\n\n  return (\n    <DashboardLayout>\n      <div className=\"min-h-screen bg-[#F2F0EB]\">\n        <div className=\"max-w-[1280px] mx-auto px-4 md:px-8 py-6 md:py-8\">\n          <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 sm:gap-6\">\n            <div>\n              <h1 className=\"text-[28px] md:text-[34px] font-semibold text-[#0F141F] leading-tight\">{pageTitle}</h1>\n              <p className=\"text-sm md:text-base text-[#6B7280] mt-1\">{pageSubtitle}</p>\n            </div>\n          </div>\n\n          <div className=\"mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n            <div className=\"flex w-full sm:w-auto items-center rounded-full bg-white border border-black/5 p-1 shadow-sm\">\n              <button\n                type=\"button\"\n                onClick={() => setMode('templates')}\n                className={`flex-1 sm:flex-none px-4 py-2 rounded-full text-sm font-medium transition text-center ${\n                  mode === 'templates' ? 'bg-[#0F141F] text-white' : 'text-[#0F141F]/70 hover:text-[#0F141F]'\n                }`}\n              >\n                Template Based\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setMode('ai')}\n                className={`flex-1 sm:flex-none px-4 py-2 rounded-full text-sm font-medium transition flex items-center justify-center gap-2 ${\n                  mode === 'ai' ? 'bg-[#0F141F] text-white' : 'text-[#0F141F]/70 hover:text-[#0F141F]'\n                }`}\n              >\n                <Sparkles className=\"w-4 h-4\" /> AI Builder\n              </button>\n            </div>\n          </div>\n\n          {mode === 'ai' ? (\n            <div className=\"mt-8\">\n              {aiStep === 'select' ? (\n                <div className=\"grid grid-cols-12 gap-6\">\n                  {/* Template picker (limited width + scrollable) */}\n                  <aside className=\"col-span-12 lg:col-span-3 bg-white rounded-[18px] border border-black/5 shadow-sm overflow-hidden\">\n                    <div className=\"px-6 pt-6 pb-4 border-b border-black/5\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-xl bg-[#0F141F] text-white flex items-center justify-center\">\n                          <Sparkles className=\"w-5 h-5\" />\n                        </div>\n                        <div>\n                          <div className=\"text-lg font-semibold text-[#0F141F]\">AI Builder</div>\n                          <div className=\"text-xs text-[#6B7280]\">Pick a template to start</div>\n                        </div>\n                      </div>\n\n                      <div className=\"mt-4 flex items-center gap-2 bg-[#F6F3ED] rounded-full px-4 py-2\">\n                        <Search className=\"w-4 h-4 text-black/35\" />\n                        <input\n                          className=\"bg-transparent outline-none text-sm w-full\"\n                          placeholder=\"Search templates…\"\n                          value={aiTemplateQuery}\n                          onChange={(e) => setAiTemplateQuery(e.target.value)}\n                        />\n                      </div>\n\n                      <div className=\"mt-3 text-[11px] text-black/45\">\n                        {aiTemplateQuery.trim()\n                          ? `Showing ${aiFilteredTemplates.length} results`\n                          : `Showing ${aiFilteredTemplates.length} templates`}\n                      </div>\n                    </div>\n\n                    <div className=\"p-4 space-y-3 overflow-y-auto max-h-[45vh] sm:max-h-[55vh] lg:max-h-[calc(100vh-320px)]\">\n                      {aiFilteredTemplates.length === 0 ? (\n                        <div className=\"text-sm text-black/45 p-2\">No templates match your search.</div>\n                      ) : (\n                        aiFilteredTemplates.map((t) => {\n                          const isSelected = selectedTemplate === t.filename;\n                          return (\n                            <button\n                              key={t.filename}\n                              type=\"button\"\n                              onClick={() => setSelectedTemplate(t.filename)}\n                              className={`w-full text-left rounded-2xl border p-4 transition ${\n                                isSelected\n                                  ? 'border-[#FF5C7A] bg-[#FFF1F4]'\n                                  : 'border-black/5 bg-[#F6F3ED] hover:border-black/10'\n                              }`}\n                            >\n                              <div className=\"text-sm font-semibold text-[#111827] truncate\">{t.name || t.filename}</div>\n                              <div className=\"text-xs text-black/45 mt-1 line-clamp-2\">{t.description || t.contract_type || ''}</div>\n                            </button>\n                          );\n                        })\n                      )}\n                    </div>\n                  </aside>\n\n                  {/* Main content */}\n                  <section className=\"col-span-12 lg:col-span-9 bg-white rounded-[18px] border border-black/5 shadow-sm p-5 sm:p-6 lg:p-8\">\n                    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n                      <div>\n                        <div className=\"text-lg font-semibold text-[#0F141F]\">Get Started</div>\n                        <div className=\"text-sm text-[#6B7280] mt-1\">Open the template in the editor and apply prompts live.</div>\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={startAiBuilder}\n                        disabled={!selectedTemplate || aiLoadingTemplate}\n                        className=\"h-11 w-full sm:w-auto px-5 rounded-full bg-[#0F141F] text-white text-sm font-semibold disabled:opacity-60\"\n                      >\n                        {aiLoadingTemplate ? 'Loading…' : aiDraftUpdatedAt ? 'Resume Draft' : 'Get Started'}\n                      </button>\n                    </div>\n\n                    {aiDraftUpdatedAt ? (\n                      <div className=\"mt-4 rounded-2xl border border-black/10 bg-[#F6F3ED] px-4 py-3 text-sm text-black/60\">\n                        Saved draft found — last updated {new Date(aiDraftUpdatedAt).toLocaleString()}.\n                      </div>\n                    ) : null}\n\n                    {aiError ? (\n                      <div className=\"mt-5 bg-rose-50 border border-rose-200 text-rose-700 px-4 py-3 rounded-2xl text-sm\">\n                        {aiError}\n                      </div>\n                    ) : null}\n\n                    <div className=\"mt-6\">\n                      <div className=\"text-sm font-semibold text-[#0F141F]\">Selected Template</div>\n                      <div className=\"mt-3 rounded-2xl border border-black/5 bg-[#F6F3ED] p-4\">\n                        <div className=\"text-sm font-semibold text-[#111827]\">\n                          {selectedTemplateObj?.name || selectedTemplate || '—'}\n                        </div>\n                        <div className=\"text-xs text-black/45 mt-1\">\n                          {selectedTemplateObj?.description || 'Template preview will open in the editor.'}\n                        </div>\n                      </div>\n                    </div>\n                  </section>\n                </div>\n              ) : (\n                <div className=\"bg-[#F2F0EB]\">\n                  <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6\">\n                    <div className=\"flex items-center gap-4 min-w-0\">\n                      <button\n                        type=\"button\"\n                        onClick={() => {\n                          stopAi();\n                          setAiStep('select');\n                        }}\n                        className=\"w-10 h-10 rounded-full bg-white border border-black/10 shadow-sm grid place-items-center text-black/45 hover:text-black\"\n                        aria-label=\"Back\"\n                      >\n                        <ChevronLeft className=\"w-5 h-5\" />\n                      </button>\n                      <div className=\"min-w-0\">\n                        <div className=\"text-xl md:text-2xl font-bold text-[#111827] truncate\">\n                          {aiTitle || selectedTemplateObj?.name || 'AI Builder'}\n                        </div>\n                        <div className=\"text-xs text-black/45 mt-1 truncate\">Template: {selectedTemplate || ''}</div>\n                      </div>\n                    </div>\n                    <div className=\"w-full sm:w-auto flex items-center gap-2\">\n                      <button\n                        type=\"button\"\n                        onClick={createDraftFromAi}\n                        disabled={loading || aiGenerating || !aiBaseText.trim() || !user}\n                        className=\"h-10 w-full sm:w-auto px-4 rounded-full bg-white border border-black/10 text-sm font-semibold text-[#111827] hover:bg-black/5 disabled:opacity-60\"\n                      >\n                        Create Draft\n                      </button>\n                    </div>\n                  </div>\n\n                  {aiError ? (\n                    <div className=\"mb-6 bg-rose-50 border border-rose-200 text-rose-700 px-4 py-3 rounded-2xl text-sm\">\n                      {aiError}\n                    </div>\n                  ) : null}\n\n                  <div className=\"grid grid-cols-12 gap-6\">\n                    {/* Editor */}\n                    <section className=\"col-span-12 lg:col-span-8 bg-white rounded-[28px] border border-black/5 shadow-sm overflow-hidden\">\n                      <div className=\"px-5 py-4 border-b border-black/5 flex items-center justify-between\">\n                        <div className=\"text-sm font-semibold text-[#111827]\">Template Editor</div>\n                        <div className=\"text-xs text-black/45\">\n                          {aiGenerating ? 'Generating suggestion…' : 'Edit content; accept AI suggestions on the right'}\n                        </div>\n                      </div>\n\n                      <div className=\"px-4 sm:px-6 py-5 sm:py-6 overflow-visible lg:overflow-y-auto lg:max-h-[calc(100vh-280px)]\">\n                        <RichTextEditor\n                          valueHtml={aiBaseHtml}\n                          disabled={aiGenerating}\n                          onEditorReady={(ed) => {\n                            aiEditorApiRef.current = ed;\n                          }}\n                          onChange={(html: string, text: string) => {\n                            setAiBaseHtml(html);\n                            setAiBaseText(text);\n                          }}\n                          editorClassName={`min-h-[50vh] sm:min-h-[60vh] rounded-2xl border border-black/10 bg-white px-5 py-4 text-[13px] leading-6 text-slate-900 font-serif outline-none ${\n                            aiGenerating ? 'opacity-80' : ''\n                          }`}\n                        />\n                      </div>\n                    </section>\n\n                    {/* AI Suggestions */}\n                    <aside className=\"col-span-12 lg:col-span-4 space-y-6\">\n                      <div className=\"bg-white rounded-[28px] border border-black/5 shadow-sm overflow-hidden\">\n                        <div className=\"px-6 pt-6 pb-4 border-b border-black/5\">\n                          <div className=\"flex items-center justify-between\">\n                            <p className=\"text-sm font-semibold text-[#111827]\">AI Suggestions</p>\n                            <span className=\"text-[11px] text-black/45\">Streaming</span>\n                          </div>\n                          <p className=\"text-xs text-black/45 mt-2\">\n                            Generate a proposed revision, then accept or reject it.\n                          </p>\n                        </div>\n\n                        <div className=\"p-5\">\n                          <textarea\n                            value={aiPrompt}\n                            onChange={(e) => setAiPrompt(e.target.value)}\n                            placeholder=\"e.g., Add a termination for convenience clause with 30 days notice, and update payment terms to Net 45.\"\n                            className=\"w-full min-h-[140px] rounded-2xl border border-black/10 bg-[#F6F3ED] px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-[#FF5C7A]/25\"\n                            disabled={aiGenerating}\n                          />\n\n                          <div className=\"mt-4 flex flex-col sm:flex-row sm:items-center gap-2\">\n                            <button\n                              type=\"button\"\n                              onClick={applyAiPrompt}\n                              disabled={aiGenerating || !aiPrompt.trim()}\n                              className=\"h-10 w-full sm:w-auto px-4 rounded-full bg-[#0F141F] text-white text-sm font-semibold disabled:opacity-60\"\n                            >\n                              {aiGenerating ? 'Generating…' : 'Generate Suggestion'}\n                            </button>\n                            {aiGenerating ? (\n                              <button\n                                type=\"button\"\n                                onClick={stopAi}\n                                className=\"h-10 w-full sm:w-auto px-4 rounded-full bg-white border border-black/10 text-sm font-semibold text-[#111827] hover:bg-black/5\"\n                              >\n                                Stop\n                              </button>\n                            ) : null}\n                          </div>\n\n                          {aiError ? <div className=\"mt-3 text-xs text-rose-600\">{aiError}</div> : null}\n\n                          <div className=\"mt-4 text-xs text-black/45\">Tip: be specific (sections, numbers, jurisdictions).</div>\n\n                          {/* Proposed revision */}\n                          <div className=\"mt-5 rounded-2xl border border-black/10 bg-white overflow-hidden\">\n                            <div className=\"px-4 py-3 border-b border-black/5 flex items-center justify-between\">\n                              <div className=\"text-xs font-semibold text-[#111827]\">Proposed Revision</div>\n                              <div className=\"text-[11px] text-black/45\">\n                                {aiSuggestionText.trim() ? 'Ready' : 'None yet'}\n                              </div>\n                            </div>\n                            <div className=\"p-4\">\n                              {!aiSuggestionText.trim() ? (\n                                <div className=\"text-sm text-[#6B7280]\">Run a prompt to generate suggestions.</div>\n                              ) : (\n                                <div className=\"text-xs text-slate-800 whitespace-pre-wrap max-h-64 overflow-y-auto\">\n                                  {aiSuggestionText}\n                                </div>\n                              )}\n\n                              <div className=\"mt-4 flex flex-col sm:flex-row sm:items-center gap-2\">\n                                <button\n                                  type=\"button\"\n                                  onClick={acceptAiSuggestion}\n                                  disabled={!aiSuggestionText.trim() || aiGenerating}\n                                  className=\"h-10 w-full sm:w-auto px-4 rounded-full bg-[#FF5C7A] text-white text-sm font-semibold disabled:opacity-60\"\n                                >\n                                  Accept\n                                </button>\n                                <button\n                                  type=\"button\"\n                                  onClick={rejectAiSuggestion}\n                                  disabled={!aiSuggestionText.trim() || aiGenerating}\n                                  className=\"h-10 w-full sm:w-auto px-4 rounded-full bg-white border border-black/10 text-sm font-semibold text-[#111827] hover:bg-black/5 disabled:opacity-60\"\n                                >\n                                  Reject\n                                </button>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </aside>\n                  </div>\n                </div>\n              )}\n            </div>\n          ) : (\n            <>\n              <div className=\"mt-8\">\n                <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                  <h2 className=\"text-sm font-semibold text-[#0F141F]\">All Templates</h2>\n                  <div className=\"flex items-center gap-2 bg-white border border-black/5 shadow-sm rounded-full px-4 py-2 w-full sm:w-[420px]\">\n                    <Search className=\"w-4 h-4 text-black/35\" />\n                    <input\n                      value={templateQuery}\n                      onChange={(e) => setTemplateQuery(e.target.value)}\n                      placeholder=\"Search templates…\"\n                      className=\"bg-transparent outline-none text-sm w-full text-[#0F141F] placeholder:text-black/35\"\n                      aria-label=\"Search templates\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"mt-4\">\n                  {templatesLoading ? (\n                    <div className=\"text-sm text-[#6B7280] py-6\">Loading templates…</div>\n                  ) : filteredTemplates.length === 0 ? (\n                    <div className=\"text-sm text-[#6B7280] py-6\">No templates match your search.</div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      {filteredTemplates.map((t) => {\n                        const isSelected = selectedTemplate === t.filename;\n                        const meta = TEMPLATE_CARD_META[t.filename] || {\n                          title: t.name,\n                          subtitle: t.description || 'Template',\n                          pill: t.contract_type || 'Template',\n                          eta: '~5 mins',\n                          iconBg: 'bg-slate-50 text-slate-700',\n                          icon: <FileText className=\"w-5 h-5\" />,\n                        };\n\n                        const createdByYou =\n                          user &&\n                          ((t as any)?.created_by_id && String((t as any).created_by_id) === String((user as any)?.user_id));\n\n                        return (\n                          <button\n                            key={t.filename}\n                            type=\"button\"\n                            onClick={() => setSelectedTemplate(t.filename)}\n                            className={`text-left bg-white rounded-[18px] border shadow-sm p-5 transition w-full ${\n                              isSelected\n                                ? 'border-[#FF5C7A] ring-2 ring-[#FF5C7A]/20'\n                                : 'border-black/5 hover:border-black/10'\n                            }`}\n                          >\n                            <div className=\"flex items-start justify-between gap-3\">\n                              <div className={`w-10 h-10 rounded-xl ${meta.iconBg} flex items-center justify-center flex-shrink-0`}>{meta.icon}</div>\n                              <div className=\"min-w-0 flex-1\">\n                                <div className=\"flex items-center justify-between gap-2\">\n                                  <div className=\"font-semibold text-[#0F141F] truncate\">{meta.title}</div>\n                                  <div\n                                    className={`w-6 h-6 rounded-full flex items-center justify-center border flex-shrink-0 ${\n                                      isSelected ? 'bg-[#FF5C7A] border-[#FF5C7A]' : 'bg-white border-black/10'\n                                    }`}\n                                  >\n                                    {isSelected ? <div className=\"w-2.5 h-2.5 rounded-full bg-white\" /> : null}\n                                  </div>\n                                </div>\n                                <div className=\"text-sm text-[#6B7280] mt-1 line-clamp-2\">{meta.subtitle}</div>\n                                <div className=\"mt-3 flex items-center gap-2 flex-wrap\">\n                                  <span className=\"text-xs px-2.5 py-1 rounded-full bg-[#F3F4F6] text-[#0F141F]/70\">\n                                    {meta.pill}\n                                  </span>\n                                  {createdByYou ? (\n                                    <span className=\"text-xs px-2.5 py-1 rounded-full bg-[#F6F3ED] text-[#0F141F]/70 border border-black/5\">\n                                      Mine\n                                    </span>\n                                  ) : null}\n                                  <span className=\"text-[11px] text-[#6B7280] truncate\">{t.filename}</span>\n                                </div>\n                              </div>\n                            </div>\n                          </button>\n                        );\n                      })}\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {error && (\n                <div className=\"mt-6 bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-2xl\">\n                  <p className=\"font-medium\">{error}</p>\n                </div>\n              )}\n\n              <form onSubmit={handleSubmit} className=\"mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6\">\n                {/* Left: Data Entry */}\n                <div className=\"bg-white rounded-[18px] border border-black/5 shadow-sm overflow-hidden lg:col-span-5\">\n                  <div className=\"px-5 py-4 border-b border-black/5 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-7 h-7 rounded-full bg-[#FF5C7A] text-white flex items-center justify-center text-xs font-bold\">1</div>\n                      <div className=\"font-semibold text-[#0F141F]\">Data Entry</div>\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        setFieldValues({});\n                        setSelectedClauseIds([]);\n                        setCustomClauses([]);\n                        setConstraints([]);\n                        if (selectedTemplate) {\n                          clearTemplateDraft(selectedTemplate);\n                          setTemplateDraftUpdatedAt(null);\n                          setTemplateDraftRestored(false);\n                        }\n                      }}\n                      className=\"text-xs text-[#FF5C7A] hover:underline\"\n                    >\n                      Clear all\n                    </button>\n                  </div>\n\n                  {templateDraftUpdatedAt ? (\n                    <div className=\"px-5 pt-4\">\n                      <div className=\"rounded-2xl border border-black/10 bg-[#F6F3ED] px-4 py-3 flex items-center justify-between gap-3\">\n                        <div className=\"text-xs text-black/60\">\n                          {templateDraftRestored ? 'Draft restored' : 'Auto-saved'} — {new Date(templateDraftUpdatedAt).toLocaleString()}\n                        </div>\n                        {selectedTemplate ? (\n                          <button\n                            type=\"button\"\n                            onClick={() => {\n                              clearTemplateDraft(selectedTemplate);\n                              setTemplateDraftUpdatedAt(null);\n                              setTemplateDraftRestored(false);\n                            }}\n                            className=\"text-xs font-semibold text-[#0F141F] hover:underline\"\n                          >\n                            Clear draft\n                          </button>\n                        ) : null}\n                      </div>\n                    </div>\n                  ) : null}\n\n                  <div className=\"p-5 space-y-6\">\n                    {!selectedTemplate ? (\n                      <div className=\"text-sm text-[#6B7280]\">Select a template to begin.</div>\n                    ) : schemaLoading ? (\n                      <div className=\"text-sm text-[#6B7280]\">Loading required fields…</div>\n                    ) : (\n                      <>\n                        {(sections.length ? sections : [{ title: 'Data Entry', fields: [] }]).map((section) => (\n                          <div key={section.title}>\n                            <div className=\"text-[11px] tracking-wider text-[#9CA3AF] font-semibold uppercase\">{section.title}</div>\n                            <div className=\"mt-3 grid grid-cols-1 md:grid-cols-2 gap-4\">\n                              {(section.fields || []).map((f: TemplateSchemaField) => (\n                                <div key={f.key} className={f.type === 'select' ? 'md:col-span-1' : ''}>\n                                  <label className=\"block text-sm font-medium text-[#374151] mb-2\">\n                                    {f.label} {f.required ? <span className=\"text-[#FF5C7A]\">*</span> : null}\n                                  </label>\n                                  {f.type === 'select' ? (\n                                    <select\n                                      value={fieldValues[f.key] || ''}\n                                      onChange={(e) => setField(f.key, e.target.value)}\n                                      className=\"w-full px-4 py-3 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40\"\n                                    >\n                                      <option value=\"\">Select…</option>\n                                      {(f.options || []).map((o) => (\n                                        <option key={o} value={o}>\n                                          {o}\n                                        </option>\n                                      ))}\n                                    </select>\n                                  ) : (\n                                    <input\n                                      type={f.type}\n                                      value={fieldValues[f.key] || ''}\n                                      onChange={(e) => setField(f.key, e.target.value)}\n                                      className=\"w-full px-4 py-3 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40\"\n                                      placeholder={f.label}\n                                    />\n                                  )}\n                                </div>\n                              ))}\n                            </div>\n                          </div>\n                        ))}\n\n                        {/* Clauses & Constraints */}\n                        <div>\n                          <div className=\"text-[11px] tracking-wider text-[#9CA3AF] font-semibold uppercase\">Clause & Constraints</div>\n                          <div className=\"mt-3 space-y-4\">\n                            <div className=\"bg-[#F7F7F7] rounded-2xl p-4 border border-black/5\">\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"font-semibold text-[#111827] text-sm\">Clause Library</div>\n                                <div className=\"text-xs text-[#6B7280]\">Optional</div>\n                              </div>\n                              <div className=\"mt-3\">\n                                <input\n                                  value={clauseQuery}\n                                  onChange={(e) => setClauseQuery(e.target.value)}\n                                  placeholder=\"Search clauses…\"\n                                  className=\"w-full px-4 py-2.5 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40\"\n                                />\n                              </div>\n                              <div className=\"mt-3 max-h-44 overflow-y-auto space-y-2 pr-1\">\n                                {clausesLoading ? (\n                                  <div className=\"text-sm text-[#6B7280]\">Loading clauses…</div>\n                                ) : filteredClauses.length === 0 ? (\n                                  <div className=\"text-sm text-[#6B7280]\">No clauses found.</div>\n                                ) : (\n                                  filteredClauses.slice(0, 50).map((c) => {\n                                    const checked = selectedClauseIds.includes(c.clause_id);\n                                    return (\n                                      <label\n                                        key={`${c.clause_id}-${c.version}`}\n                                        className=\"flex items-start gap-3 bg-white rounded-xl border border-black/5 p-3 cursor-pointer hover:border-black/10\"\n                                      >\n                                        <input\n                                          type=\"checkbox\"\n                                          checked={checked}\n                                          onChange={() => toggleClause(c.clause_id)}\n                                          className=\"mt-1\"\n                                        />\n                                        <div className=\"min-w-0\">\n                                          <div className=\"text-sm font-semibold text-[#111827] truncate\">{c.name}</div>\n                                          <div className=\"text-xs text-[#6B7280]\">{c.clause_id}</div>\n                                        </div>\n                                      </label>\n                                    );\n                                  })\n                                )}\n                              </div>\n                            </div>\n\n                            <div className=\"bg-[#F7F7F7] rounded-2xl p-4 border border-black/5\">\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"font-semibold text-[#111827] text-sm\">Constraints</div>\n                                <button\n                                  type=\"button\"\n                                  onClick={addConstraint}\n                                  className=\"text-xs px-3 py-1.5 rounded-full bg-white border border-black/10 hover:border-black/20\"\n                                >\n                                  Add\n                                </button>\n                              </div>\n\n                              {/* Constraint Library */}\n                              <div className=\"mt-3\">\n                                <div className=\"text-xs font-semibold text-[#6B7280]\">Constraint Library</div>\n                                <input\n                                  value={constraintLibraryQuery}\n                                  onChange={(e) => setConstraintLibraryQuery(e.target.value)}\n                                  placeholder=\"Search constraints…\"\n                                  className=\"mt-2 w-full px-4 py-2.5 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40\"\n                                />\n                                <div className=\"mt-2 max-h-44 overflow-y-auto space-y-2 pr-1\">\n                                  {constraintLibraryLoading ? (\n                                    <div className=\"text-sm text-[#6B7280]\">Loading constraints…</div>\n                                  ) : constraintLibrary.length === 0 ? (\n                                    <div className=\"text-sm text-[#6B7280]\">No constraints available.</div>\n                                  ) : (\n                                    constraintLibrary\n                                      .filter((x) => {\n                                        const q = constraintLibraryQuery.trim().toLowerCase();\n                                        if (!q) return true;\n                                        const hay = `${x.label || ''} ${x.key || ''} ${x.category || ''}`.toLowerCase();\n                                        return hay.includes(q);\n                                      })\n                                      .slice(0, 40)\n                                      .map((x) => (\n                                        <button\n                                          key={x.key}\n                                          type=\"button\"\n                                          onClick={() => addConstraintFromLibrary(x)}\n                                          className=\"w-full text-left bg-white rounded-xl border border-black/5 p-3 hover:border-black/10\"\n                                        >\n                                          <div className=\"flex items-center justify-between gap-3\">\n                                            <div className=\"min-w-0\">\n                                              <div className=\"text-sm font-semibold text-[#111827] truncate\">{x.label}</div>\n                                              <div className=\"text-xs text-[#6B7280]\">\n                                                {(x.category || 'General') + (x.default ? ` • Default: ${String(x.default)}` : '')}\n                                              </div>\n                                            </div>\n                                            <div className=\"text-xs font-semibold text-[#FF5C7A]\">Add</div>\n                                          </div>\n                                        </button>\n                                      ))\n                                  )}\n                                </div>\n                              </div>\n\n                              <div className=\"mt-3 space-y-3\">\n                                {constraints.length === 0 ? (\n                                  <div className=\"text-sm text-[#6B7280]\">Add constraints like jurisdiction, data residency, liability caps, etc.</div>\n                                ) : (\n                                  constraints.map((c, idx) => (\n                                    <div key={idx} className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                                      <input\n                                        value={c.name}\n                                        onChange={(e) =>\n                                          setConstraints((p) => p.map((x, i) => (i === idx ? { ...x, name: e.target.value } : x)))\n                                        }\n                                        placeholder=\"Constraint name\"\n                                        className=\"w-full px-4 py-2.5 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40\"\n                                      />\n                                      <div className=\"flex gap-2\">\n                                        <input\n                                          value={c.value}\n                                          onChange={(e) =>\n                                            setConstraints((p) => p.map((x, i) => (i === idx ? { ...x, value: e.target.value } : x)))\n                                          }\n                                          placeholder=\"Value\"\n                                          className=\"flex-1 px-4 py-2.5 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40\"\n                                        />\n                                        <button\n                                          type=\"button\"\n                                          onClick={() => setConstraints((p) => p.filter((_, i) => i !== idx))}\n                                          className=\"px-3 py-2.5 rounded-xl bg-white border border-black/10 hover:border-black/20 text-[#6B7280]\"\n                                          aria-label=\"Remove constraint\"\n                                        >\n                                          ✕\n                                        </button>\n                                      </div>\n                                    </div>\n                                  ))\n                                )}\n                              </div>\n                            </div>\n\n                            <div className=\"bg-[#F7F7F7] rounded-2xl p-4 border border-black/5\">\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"font-semibold text-[#111827] text-sm\">Custom Clauses</div>\n                                <button\n                                  type=\"button\"\n                                  onClick={addCustomClause}\n                                  className=\"text-xs px-3 py-1.5 rounded-full bg-white border border-black/10 hover:border-black/20\"\n                                >\n                                  Add\n                                </button>\n                              </div>\n                              <div className=\"mt-3 space-y-3\">\n                                {customClauses.length === 0 ? (\n                                  <div className=\"text-sm text-[#6B7280]\">Add custom clauses like non-solicit, security, SLA, etc.</div>\n                                ) : (\n                                  customClauses.map((c, idx) => (\n                                    <div key={idx} className=\"bg-white rounded-2xl border border-black/5 p-3\">\n                                      <div className=\"flex items-center justify-between gap-2\">\n                                        <input\n                                          value={c.title || ''}\n                                          onChange={(e) =>\n                                            setCustomClauses((p) => p.map((x, i) => (i === idx ? { ...x, title: e.target.value } : x)))\n                                          }\n                                          placeholder=\"Clause title\"\n                                          className=\"flex-1 px-4 py-2.5 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40\"\n                                        />\n                                        <button\n                                          type=\"button\"\n                                          onClick={() => setCustomClauses((p) => p.filter((_, i) => i !== idx))}\n                                          className=\"px-3 py-2.5 rounded-xl bg-white border border-black/10 hover:border-black/20 text-[#6B7280]\"\n                                          aria-label=\"Remove custom clause\"\n                                        >\n                                          ✕\n                                        </button>\n                                      </div>\n                                      <textarea\n                                        value={c.content}\n                                        onChange={(e) =>\n                                          setCustomClauses((p) => p.map((x, i) => (i === idx ? { ...x, content: e.target.value } : x)))\n                                        }\n                                        placeholder=\"Write clause content…\"\n                                        className=\"mt-3 w-full px-4 py-3 border border-black/10 rounded-xl bg-white focus:ring-2 focus:ring-[#FF5C7A]/30 focus:border-[#FF5C7A]/40 min-h-[96px]\"\n                                      />\n                                    </div>\n                                  ))\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                </div>\n\n                {/* Right: Live Preview */}\n                <div className=\"bg-white rounded-[18px] border border-black/5 shadow-sm overflow-hidden lg:col-span-7 lg:sticky lg:top-6 self-start\">\n                  <div className=\"px-5 py-4 border-b border-black/5 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"text-xs text-[#6B7280] font-semibold\">Live Preview</div>\n                    </div>\n                  </div>\n\n                  <div className=\"p-4\">\n                    <div className=\"bg-[#EEF0F3] rounded-[18px] p-2 sm:p-3\">\n                      <div className=\"bg-white rounded-[14px] shadow-sm border border-black/5 overflow-hidden\">\n                        <div\n                          className=\"p-5 sm:p-6 overflow-visible lg:overflow-y-auto lg:max-h-[calc(100vh-320px)]\"\n                        >\n                          {previewLoading ? (\n                            <div className=\"text-sm text-[#6B7280]\">Generating preview…</div>\n                          ) : !selectedTemplate ? (\n                            <div className=\"text-sm text-[#6B7280]\">Select a template to preview.</div>\n                          ) : previewText ? (\n                            <div className=\"inline-block min-w-full\">\n                              <pre className=\"whitespace-pre-wrap text-[13px] leading-relaxed text-[#111827] font-serif\">\n                                {previewText}\n                              </pre>\n                            </div>\n                          ) : (\n                            <div className=\"text-sm text-[#6B7280]\">Start filling fields to see a preview.</div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n                      <div className=\"text-sm text-[#6B7280] min-w-0\">\n                        {!user ? 'Please log in to create contracts.' : schema?.template_type ? `Type: ${schema.template_type}` : null}\n                      </div>\n                      <button\n                        type=\"submit\"\n                        disabled={isCreateDisabled}\n                        className=\"bg-[#0F141F] text-white w-full sm:w-auto px-7 py-3.5 rounded-full shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap flex-shrink-0\"\n                      >\n                        {loading ? 'Creating…' : 'Move to editor'}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </>\n          )}\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n};\n\nconst CreateContractPage = () => {\n  return (\n    <Suspense\n      fallback={\n        <div className=\"min-h-screen bg-[#F2F0EB] p-8\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"bg-white rounded-[20px] shadow-sm p-6 text-gray-600\">\n              Loading...\n            </div>\n          </div>\n        </div>\n      }\n    >\n      <CreateContractInner />\n    </Suspense>\n  );\n};\n\nexport default CreateContractPage;"],"names":[],"mappings":"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"}