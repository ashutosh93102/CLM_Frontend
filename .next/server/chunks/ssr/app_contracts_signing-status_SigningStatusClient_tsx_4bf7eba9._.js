module.exports=[85271,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(70106);let f=(0,e.default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),g=(0,e.default)("clock-3",[["path",{d:"M12 6v6h4",key:"135r8i"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),h=(0,e.default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),i=(0,e.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var j=a.i(52072),k=a.i(98448);function l(a){if(!a)return"—";let b=new Date(String(a));return Number.isNaN(b.getTime())?String(a):b.toLocaleString()}async function m(a){try{if("undefined"!=typeof navigator&&navigator.clipboard?.writeText)return await navigator.clipboard.writeText(a),!0}catch{}try{let b=document.createElement("textarea");b.value=a,b.setAttribute("readonly","true"),b.style.position="fixed",b.style.left="-9999px",document.body.appendChild(b),b.select();let c=document.execCommand("copy");return b.remove(),c}catch{return!1}}function n(a,b){let c,d=(c=String(String(a?.name||"").trim()||"").trim())?c.includes("@")?c:c.split(/\s+/).filter(Boolean).map(a=>/^[a-zA-Z]+$/.test(a)?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():a).join(" "):"";if(d)return d;let e=String(a?.email||"").trim();return e||`Signer ${b+1}`}function o(a,b){for(let c of b){let b=a?.[c];if(null!=b&&""!==b)return b}return null}function p(a){let c=String(a.label||"").trim(),d=c.toLowerCase(),e=["declined","rejected","canceled","cancelled","refused"].includes(d),f=["signed","completed","executed","done"].includes(d),g=["sent","invited","pending","in_progress","in progress","viewed"].includes(d);return(0,b.jsx)("span",{className:`px-2 py-1 rounded-full border text-[11px] font-semibold ${e?"bg-rose-50 text-rose-700 border-rose-200":f?"bg-emerald-50 text-emerald-700 border-emerald-200":g?"bg-amber-50 text-amber-800 border-amber-200":"bg-slate-50 text-slate-700 border-slate-200"}`,children:c||"—"})}function q(a){let c=String(a.name||a.email||"").trim(),{bg:d,fg:e}=function(a){let b=String(a||""),c=0;for(let a=0;a<b.length;a++)c=31*c+b.charCodeAt(a)|0;let d=[{bg:"bg-indigo-100",fg:"text-indigo-700"},{bg:"bg-violet-100",fg:"text-violet-700"},{bg:"bg-sky-100",fg:"text-sky-700"},{bg:"bg-emerald-100",fg:"text-emerald-700"},{bg:"bg-amber-100",fg:"text-amber-800"},{bg:"bg-rose-100",fg:"text-rose-700"}],e=Math.abs(c)%d.length;return d[e]}(a.email||a.name||c);return(0,b.jsx)("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${d} ${e} font-extrabold text-sm flex-shrink-0`,children:function(a){let b=String(a||"").trim();if(!b)return"?";let c=b.includes("@")?b:"",d=c?"":b;if(d){let a=d.split(/\s+/).filter(Boolean);return((a[0]?.[0]||"")+(a.length>1&&a[a.length-1]?.[0]||"")).toUpperCase()||"?"}return c?(c.split("@")[0]||c).slice(0,2).toUpperCase()||"?":b.slice(0,2).toUpperCase()||"?"}(c)})}function r(a){let c=String(a.status||"").trim().toLowerCase(),d=["declined","rejected","canceled","cancelled","refused","failed","error"].includes(c);return["signed","completed","executed","done","finished"].includes(c)?(0,b.jsx)(f,{className:"h-4 w-4 text-emerald-600","aria-hidden":"true"}):d?(0,b.jsx)(i,{className:"h-4 w-4 text-rose-600","aria-hidden":"true"}):(0,b.jsx)(g,{className:"h-4 w-4 text-amber-600","aria-hidden":"true"})}function s(a){let b=String(a?.status||"").trim();if(b){let a,c;return"finished"===(c=(a=String(b||"").trim()).toLowerCase())?"completed":"not_sent"===c?"draft":"in_progress"===c?"in progress":a}return a?.has_signed?"signed":"pending"}function t(a){return(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`h-10 w-10 rounded-full flex items-center justify-center border ${a.active?"bg-emerald-50 border-emerald-200":"bg-white border-slate-200"}`,children:(0,b.jsx)("div",{className:`h-3 w-3 rounded-full ${a.active?"bg-emerald-500":"bg-slate-300"}`})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:a.title}),a.subtitle?(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-0.5",children:a.subtitle}):null]})]})}function u(a){let c=[{key:"invite_sent",label:"Invite Sent"},{key:"recipient_received",label:"Recipient Received"},{key:"signature_pending",label:"Signature Pending"},{key:"completed",label:"Completed"}],d=Math.max(0,c.reduce((b,c,d)=>a.steps[c.key]?d:b,0));return(0,b.jsx)("div",{className:"mt-5",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-6 right-6 top-5 h-[2px] bg-slate-200"}),(0,b.jsx)("div",{className:"absolute left-6 top-5 h-[2px] bg-emerald-400",style:{width:`calc(${d/(c.length-1)*100}% - 0px)`}}),(0,b.jsx)("div",{className:"grid grid-cols-4 gap-3",children:c.map((c,e)=>{let f=!!a.steps[c.key],g=e<d;return(0,b.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,b.jsx)("div",{className:`h-10 w-10 rounded-full border-2 flex items-center justify-center ${g||f?"bg-emerald-500 border-emerald-500":"bg-white border-slate-300"}`,children:g?(0,b.jsx)("div",{className:"h-4 w-4 rounded-full bg-white"}):(0,b.jsx)("div",{className:`h-3 w-3 rounded-full ${f?"bg-white":"bg-slate-300"}`})}),(0,b.jsx)("div",{className:`mt-2 text-xs font-semibold ${g||f?"text-slate-900":"text-slate-400"}`,children:c.label}),a.meta[c.key]?.subtitle?(0,b.jsx)("div",{className:"mt-0.5 text-[11px] text-slate-400",children:a.meta[c.key]?.subtitle}):null]},c.key)})})]})})}function v(a){return(0,b.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,b.jsx)(t,{title:"Invite Sent",active:!!a.steps.invite_sent,subtitle:a.meta.invite_sent?.subtitle}),(0,b.jsx)(t,{title:"Recipient Received",active:!!a.steps.recipient_received,subtitle:a.meta.recipient_received?.subtitle}),(0,b.jsx)(t,{title:"Signature Pending",active:!!a.steps.signature_pending,subtitle:a.meta.signature_pending?.subtitle}),(0,b.jsx)(t,{title:"Completed",active:!!a.steps.completed,subtitle:a.meta.completed?.subtitle})]})}function w(){let a,e,f=(0,d.useRouter)(),g=(0,d.useSearchParams)(),i=g?.get("id")||"",[t,w]=(0,c.useState)(!0),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(null),P=(0,c.useMemo)(()=>{let a,b,c,d;return a=String(z?.status||"").toLowerCase(),c=(b=Array.isArray(z?.signers)?z.signers:[]).some(a=>["viewed","in_progress","signed"].includes(String(a?.status||"").toLowerCase())||!!a?.has_signed),d=!!z?.all_signed||b.length>0&&b.every(a=>!!a?.has_signed),{invite_sent:["sent","in_progress","completed","declined"].includes(a)||b.length>0,recipient_received:c,signature_pending:(["sent","in_progress"].includes(a)||b.length>0)&&!d,completed:"completed"===a||d}},[z]),Q=(0,c.useMemo)(()=>{let a=String(z?.status||"").toLowerCase(),b=(Array.isArray(z?.signers)?z.signers:[]).some(a=>["declined","rejected","canceled","cancelled","refused"].includes(String(a?.status||"").toLowerCase()));return"declined"===a||b},[z]),R=(0,c.useMemo)(()=>String(z?.title||z?.name||z?.document_title||z?.document_name||"Signing status"),[z]),S=(0,c.useMemo)(()=>String(R||i||"contract").trim().replace(/\s+/g,"_"),[R,i]),T=(0,c.useMemo)(()=>{let a;return(a=String(i||"").trim())?a.length<=18?{short:a,full:a}:{short:`${a.slice(0,8)}…${a.slice(-6)}`,full:a}:{short:"—",full:""}},[i]),U=async()=>{if(i)try{let a=new k.ApiClient;E(!0),G(null);let[b,c]=await Promise.all([a.inhouseStatus(i),a.inhouseAudit(i,{limit:200})]);if(!b.success)throw Error(b.error||"Failed to load signing status");if(A(b.data),c.success){let a=Array.isArray(c.data?.logs)?c.data.logs:[];C(a)}else G(c.error||"Failed to load audit logs");M(Date.now())}catch(a){y(a instanceof Error?a.message:"Failed to load signing status")}finally{E(!1)}};(0,c.useEffect)(()=>{i&&(w(!0),y(null),U().finally(()=>w(!1)))},[i]);let V=async()=>{if(i)try{I(!0),y(null);let a=new k.ApiClient,b=await a.inhouseDownloadCertificate(i);if(!b.success||!b.data)return void y(b.error||"Failed to download certificate");let c=URL.createObjectURL(b.data),d=document.createElement("a");d.href=c,d.download=`${S}_certificate.pdf`,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(c)}finally{I(!1)}},W=async()=>{if(i){if(!P.completed)return void y("Signing is not completed yet.");try{K(!0),y(null);let a=new k.ApiClient,b=await a.inhouseDownloadExecutedPdf(i);if(!b.success||!b.data)return void y(b.error||"Failed to download signed PDF");let c=URL.createObjectURL(b.data),d=document.createElement("a");d.href=c,d.download=`${S}_signed.pdf`,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(c)}finally{K(!1)}}};return(0,b.jsxs)(j.default,{children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-extrabold text-slate-900 break-words sm:truncate",children:R||"Signing status"}),(a=Q?"DECLINED":P.completed?"COMPLETED":P.signature_pending?"SIGNATURE PENDING":P.recipient_received?"RECIPIENT RECEIVED":P.invite_sent?"INVITE SENT":"—",e=Q?"bg-rose-100 text-rose-800":P.completed?"bg-emerald-100 text-emerald-800":"bg-amber-100 text-amber-800",(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-[11px] font-extrabold tracking-wide ${e}`,children:a}))]}),(0,b.jsxs)("div",{className:"mt-1 text-xs text-slate-500 space-y-0.5",children:[i?(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)("span",{className:"font-semibold text-slate-600",children:"ID:"}),(0,b.jsxs)("button",{type:"button",onClick:()=>{m(String(i)).then(a=>{a&&O(Date.now())})},className:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] font-mono text-slate-700 hover:bg-slate-50 max-w-full",title:T.full,children:[(0,b.jsx)(h,{className:"h-3.5 w-3.5 text-slate-500 flex-shrink-0","aria-hidden":"true"}),(0,b.jsx)("span",{className:"break-all",children:T.short})]}),N&&Date.now()-N<2e3?(0,b.jsx)("span",{className:"text-[11px] text-emerald-700 font-semibold",children:"Copied"}):null]}):null,(0,b.jsx)("div",{className:"flex flex-wrap gap-x-2 gap-y-1",children:L?(0,b.jsxs)("span",{children:["Last update: ",function(a){if(!a||a<0)return"—";let b=Math.floor(a/1e3);if(b<5)return"just now";if(b<60)return`${b}s ago`;let c=Math.floor(b/60);if(c<60)return`${c} min${1===c?"":"s"} ago`;let d=Math.floor(c/60);if(d<24)return`${d} hr${1===d?"":"s"} ago`;let e=Math.floor(d/24);return`${e} day${1===e?"":"s"} ago`}(Date.now()-L)]}):null})]})]}),(0,b.jsx)("div",{className:"w-full sm:w-auto",children:(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:flex sm:flex-wrap sm:items-center sm:justify-end sm:gap-2",children:[P.completed?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{type:"button",onClick:()=>void W(),disabled:J,className:"col-span-3 sm:col-span-auto h-9 sm:h-10 px-4 rounded-full bg-slate-900 text-white text-xs sm:text-sm font-semibold hover:bg-slate-800 disabled:opacity-60",children:J?"Downloading…":"Signed PDF"}),(0,b.jsx)("button",{type:"button",onClick:()=>void V(),disabled:H,className:"col-span-3 sm:col-span-auto h-9 sm:h-10 px-4 rounded-full bg-white border border-slate-200 text-xs sm:text-sm font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-60",children:H?"Downloading…":"Certificate"})]}):null,(0,b.jsx)("button",{type:"button",onClick:()=>f.push(`/contracts/editor?id=${encodeURIComponent(i)}`),className:"col-span-1 h-9 sm:h-10 px-3 sm:px-4 rounded-full bg-white border border-slate-200 text-xs sm:text-sm font-semibold text-slate-700 hover:bg-slate-50",children:"Back"}),(0,b.jsx)("button",{type:"button",onClick:()=>void U(),className:"col-span-1 h-9 sm:h-10 px-3 sm:px-4 rounded-full bg-white border border-slate-200 text-xs sm:text-sm font-semibold text-slate-700 hover:bg-slate-50",children:"Refresh"})]})})]}),t?(0,b.jsx)("div",{className:"py-16 text-center text-slate-500",children:"Loading…"}):null,x?(0,b.jsx)("div",{className:"py-2 text-sm text-rose-600",children:x}):null,(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-3xl border border-slate-200 p-4 sm:p-6",children:[(0,b.jsx)("div",{className:"text-sm font-extrabold text-slate-900",children:"Signature Tracking"}),Q?(0,b.jsx)("div",{className:"mt-3 rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-800",children:"A recipient declined the signing request. You can update recipients in the editor and resend invitations."}):null,(0,b.jsx)("div",{className:"sm:hidden",children:(0,b.jsx)(v,{steps:P,meta:{invite_sent:{subtitle:""},recipient_received:{subtitle:""},signature_pending:{subtitle:"In progress"},completed:{subtitle:P.completed?"Done":"Awaiting"}}})}),(0,b.jsx)("div",{className:"hidden sm:block",children:(0,b.jsx)(u,{steps:P,meta:{invite_sent:{subtitle:""},recipient_received:{subtitle:""},signature_pending:{subtitle:"In progress"},completed:{subtitle:P.completed?"Done":"Awaiting"}}})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-3xl border border-slate-200 p-4 sm:p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm font-extrabold text-slate-900",children:"Recipients"}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:Array.isArray(z?.signers)?`${z.signers.length} signers`:"—"})]}),(0,b.jsx)("div",{className:"mt-4 space-y-2",children:Array.isArray(z?.signers)&&z.signers.length>0?z.signers.map((a,c)=>{var d;let e,f,g;return(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 rounded-2xl border border-slate-200 p-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,b.jsx)(q,{name:String(a.name||""),email:String(a.email||"")}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900 break-words leading-snug",children:n(a,c)}),a?.email?(0,b.jsx)("div",{className:"text-xs text-slate-500 break-all leading-snug",children:String(a.email||"")}):null,(g=String(a?.declined_reason||a?.reason||"").trim())?["declined","rejected","canceled","cancelled","refused","failed","error"].includes(String(s(a)||"").trim().toLowerCase())?(0,b.jsxs)("div",{className:"text-[11px] text-rose-700 mt-0.5 truncate",children:["Reason: ",g]}):null:null]})]}),(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-2 sm:justify-end",children:(e=s(a),f=["signed","completed","executed","done","finished"].includes(String(String(s(d=a)||"").toLowerCase()||"").trim().toLowerCase())?d?.signed_at||d?.signedAt:d?.status_updated_at||d?.updated_at||d?.updatedAt,(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r,{status:String(e)}),(0,b.jsx)(p,{label:String(e)}),f?(0,b.jsx)("span",{className:"text-[11px] text-slate-400 w-full sm:w-auto",children:l(f)}):null]}))})]},`${String(a.email||"signer")}-${c}`)}):(0,b.jsx)("div",{className:"text-sm text-slate-500",children:"No recipient info yet."})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-3xl border border-slate-200 p-4 sm:p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm font-extrabold text-slate-900",children:"Audit Logs"}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:B.length?`${B.length} events`:"—"})]}),(0,b.jsxs)("div",{className:"mt-4 space-y-2",children:[D?(0,b.jsx)("div",{className:"text-sm text-slate-500",children:"Loading audit logs…"}):null,F?(0,b.jsx)("div",{className:"text-sm text-rose-600",children:F}):null,D||F||0!==B.length?null:(0,b.jsx)("div",{className:"text-sm text-slate-500",children:"No audit events yet."}),B.map((a,c)=>{let d,e=a?.created_at,f=a?.signer,g=f?n(f,0):"",h=f?String(f?.email||"").trim():"",i=(d=String(a?.event||"").trim())?d.replace(/_/g," ").split(/\s+/).filter(Boolean).map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"Event",j=String(a?.message||"").trim();return(0,b.jsx)("div",{className:"rounded-2xl border border-slate-200 p-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900 break-words",children:i}),g||h?(0,b.jsxs)("div",{className:"mt-0.5 text-[11px] text-slate-500 break-all",children:[g||h,g&&h?` (${h})`:""]}):null,j?(0,b.jsx)("div",{className:"mt-1 text-xs text-slate-700 break-words",children:j}):null]}),(0,b.jsx)("div",{className:"text-[11px] text-slate-400 flex-shrink-0",children:l(e)})]})},`${String(a?.id||"")}-${c}`)})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-3xl border border-slate-200 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm font-extrabold text-slate-900",children:"Summary Details"}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:"Provider: In-house"})]}),(0,b.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 p-4",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Status"}),(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,b.jsx)("div",{className:"text-sm font-bold text-slate-900",children:String(z?.status||"—")}),z?.all_signed?(0,b.jsx)(p,{label:"all signed"}):null]}),(0,b.jsxs)("div",{className:"mt-3 text-xs text-slate-500",children:["Signers: ",Array.isArray(z?.signers)?z.signers.length:0,z?.all_signed?" · All signed":""]})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 p-4",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-slate-700",children:"Dates"}),(0,b.jsxs)("div",{className:"mt-2 space-y-1 text-xs text-slate-600",children:[(0,b.jsxs)("div",{children:["Created: ",(0,b.jsx)("span",{className:"font-semibold text-slate-900",children:l(o(z,["created_at","createdAt","created"]))})]}),(0,b.jsxs)("div",{children:["Completed: ",(0,b.jsx)("span",{className:"font-semibold text-slate-900",children:l(o(z,["completed_at","completedAt","executed_at","finished_at"]))})]}),(0,b.jsxs)("div",{children:["Expires: ",(0,b.jsx)("span",{className:"font-semibold text-slate-900",children:l(o(z,["expires_at","expiresAt","expiration"]))})]})]})]})]})]})]}),(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-white rounded-3xl border border-slate-200 p-6",children:[(0,b.jsx)("div",{className:"text-sm font-extrabold text-slate-900",children:"Notes"}),(0,b.jsx)("div",{className:"mt-2 text-sm text-slate-600",children:"This page tracks signer status and completed downloads."})]})})]})]})}a.s(["default",()=>w],85271)}];

//# sourceMappingURL=app_contracts_signing-status_SigningStatusClient_tsx_4bf7eba9._.js.map